{% extends 'base.html' %}
{% block content %}
{%csrf_token%}
{% load static %}

  <style>
  .carousel-inner{
      width:100%;
      height:50%;

  }
  /* Make the image fully responsive */
  .carousel-inner img {
      width: 100%;
      height: 100%;
  }
#stars-outer {
  position: relative;
  display: inline-block;
}

#stars-inner {
  position: absolute;
  top: 0;
  left: 0;
  white-space: nowrap;
  overflow: hidden;
  width: 0;
}

#stars-outer::before {
  content: "\f005 \f005 \f005 \f005 \f005";
  font-family: "Font Awesome 5 Free";
  font-weight: 900;
  color: #ccc;
}

#stars-inner::before {
  content: "\f005 \f005 \f005 \f005 \f005";
  font-family: "Font Awesome 5 Free";
  font-weight: 900;
  color: #f8ce0b;
}

  </style>
  <script>
  const starsTotal = 5;
  function updateRate(rate){
    $.ajax({
    type: 'POST',
            url: "/projectrate/",
            data:{"rate":rate,
            "id":{{project.id}},
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
            success: function (response) {
                console.log("response")
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response);
            }
        })
    }
    function updateComment(comment){
        $.ajax({
            type:'GET',
            url:"/projectcomment/",
            data:{"comment":comment,
            "id":{{project.id}},
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
            success: function (response) {
                $("#commentinput").val("");
                newcomment=`<div class="media mb-4">
                            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                              <div class="media-body">
                                <h5 class="mt-0"> {{user}}</h5>
                                ${comment}
                              </div>
                            </div>`
                $("#comments").append(newcomment);

                console.log("response");
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response);
            }

        })
    }


    // Run getRatings when DOM loads
    document.addEventListener('DOMContentLoaded', function(){
       getRatings({{rate}});
       console.log({{rate}});
       document.querySelector("#submit").onclick=function(){
       comment=document.getElementsByTagName("textarea")[0].value;
       console.log(comment);
       updateComment(comment);}
       const ratingControl = document.getElementById('rating-control');
       ratingControl.value ={{rate}};

       ratingControl.addEventListener('change', (e) => {
            const rating = e.target.value;
              // Change rating
            getRatings(rating);
            updateRate(rating);


    });
});


    function getRatings(ratee) {

        // Get percentage
        const starPercentage = ( ratee / starsTotal) * 100;

        // Round to nearest 10
        const starPercentageRounded = `${Math.round(starPercentage / 10) * 10}%`;

        // Set width of stars-inner to percentage
        document.querySelector(`#stars-inner`).style.width = starPercentageRounded;

        // Add number rating
        document.querySelector(`.number-rating`).innerHTML = ratee;
    }

</script>

  <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8">

        <!-- Title -->
        <h1 class="mt-4">{{project.title}}</h1>

        <!-- Author -->
        <p class="lead">
          by
          <a href="#">{{project.user_id}}</a>
        </p>

        <hr>

        <!-- Date/Time -->
        <p>{{project.start_date}}</p>

        <hr>

        <!-- Preview Image -->
       <div id="demo" class="carousel slide" data-ride="carousel">

  <!-- Indicators -->
        <ul class="carousel-indicators">

        {% for i in picnum%}
        {%if not i %}
        <li data-target="#demo" data-slide-to="{{i}}" class="active"></li>
        {%else%}
        <li data-target="#demo" data-slide-to="{{i}}" ></li>
        {% endif %}
        {% endfor %}

      </ul>

  <!-- The slideshow -->
          <div class="carousel-inner">
            {% for i in picnum %}
              {%if not i %}

                <div class="carousel-item active" >
                  <img src="{% static '' %}{{pictures.0}}"  width="1100" height="500">
                </div>
              {% else %}
                {%for picture in pictures %}
                    {%if picture != pictures.0 %}
                <div class="carousel-item " >
                  <img src="{% static '' %}{{picture}}"  width="1100" height="500">

                </div>
                {% endif %}
                {% endfor %}
                {% endif %}
                {% endfor %}

          </div>

          <!-- Left and right controls -->
          <a class="carousel-control-prev" href="#demo" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </a>
          <a class="carousel-control-next" href="#demo" data-slide="next">
            <span class="carousel-control-next-icon"></span>
          </a>
        </div>
        <div >
            <div><h3 class="fa">Donation:</h3></div>
              <div class="progress">
                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{donationbar}}"
                  aria-valuemin="0" aria-valuemax="100" style="width:100%">
                  {% widthratio donationbar 1 100 %}% Complete (success)
                </div>
              </div>
        </div>


        <hr>

        <!-- Post Content -->
        <p class="lead">{{project.details}}</p>


        <hr>

        <!-- Comments Form -->
        <div class="card my-4">
          <h5 class="card-header">Leave a Comment:</h5>
          <div class="card-body">
            <div>
              <div class="form-group">
                <textarea class="form-control" id="commentinput" rows="3"></textarea>
              </div>
              <button  id="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>

        <!-- Single Comment -->
        <fragment id="comments">
        {% for comment in comments %}
        <div class="media mb-4">
          <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
          <div class="media-body">
            <h5 class="mt-0"> {{ comment.0 }}</h5>
            {{ comment.1 }}
          </div>
        </div>
        {% endfor %}
        </fragment>
        <!-- Comment with nested comments -->



</div>
      <!-- Sidebar Widgets Column -->
      <div class="col-md-4">

        <!-- Rate Widget -->
        <div class="card my-4">
          <h5 class="card-header">Rate</h5>
          <div class="card-body">
            <div >
                <div class="form-group">
                    <input type="number" id="rating-control" class="form-control" step="1" min="1" max="5" placeholder="Rate 1 - 5" >
                </div>
                <div id="stars-outer">
                    <div id="stars-inner"></div>
                </div>
                    <span class="number-rating"></span>
            </div>
          </div>
        </div>

        <!-- Tags Widget -->
          <div class="card my-4">
          <h5 class="card-header">Tags</h5>
          <div class="card-body">
            <div class="row">
              {% for tag in tags %}
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#">{{tag}}</a>
                  </li>
                </ul>
              </div>
              {% endfor %}
        </div>
    </div>
     </div>   <!-- Category Widget -->
        <div class="card my-4">
          <h5 class="card-header">Category</h5>
          <div class="card-body">
            {{project.category}}
          </div>
        </div>
      </div>
    </div>
    <!-- /.row -->
{% endblock %}






