<!DOCTYPE html>
<html lang="en">
{%csrf_token%}
<head>
  <title>Project Details</title>
  {% load static %}
  <link href='{% static "style\bootstrap\css\bootstrap.css" %}' rel="stylesheet" />
    <script src='{% static "style\jquery\jquery-3.4.1.min.js" %}'></script>
    <script src="{% static 'style\bootstrap\js\popper.js' %}"></script>
    <script src="{% static 'style\bootstrap\js\bootstrap.js' %}"></script>
    <script src="{% static 'dist\jquery.emojiRatings.js' %}"></script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
  .carousel-inner{
      width:100%;
      height:50%;

  }
  /* Make the image fully responsive */
  .carousel-inner img {
      width: 100%;
      height: 100%;
  }
  </style>
  <script>
  function updateRate(rate){
    $.ajax({
    type: 'POST',
            url: "/projectrate/",
            data:{"rate":rate,
            "id":{{project.id}},
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
            success: function (response) {
                console.log("response")
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response);
            }
        })
    }
    function updateComment(comment){
        $.ajax({
            type:'GET',
            url:"/projectcomment/",
            data:{"comment":comment,
            "id":{{project.id}},
            csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()},
            success: function (response) {
                newcomment=`<div class="media mb-4">
                            <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
                              <div class="media-body">
                                <h5 class="mt-0"> {{user}}</h5>
                                ${comment}
                              </div>
                            </div>`
                $("#comments").append(newcomment)
                console.log("response")
            },
            error: function (response) {
                // alert the error if any error occured
                alert(response);
            }

        })
    }
  </script>
</head>
<body>
<div class="container">

    <div class="row">

      <!-- Post Content Column -->
      <div class="col-lg-8">

        <!-- Title -->
        <h1 class="mt-4">{{project.title}}</h1>

        <!-- Author -->
        <p class="lead">
          by
          <a href="#">{{project.user_id}}</a>
        </p>

        <hr>

        <!-- Date/Time -->
        <p>{{project.start_date}}</p>

        <hr>

        <!-- Preview Image -->
       <div id="demo" class="carousel slide" data-ride="carousel">

  <!-- Indicators -->
        <ul class="carousel-indicators">

        {% for i in picnum%}
        {%if not i %}
        <li data-target="#demo" data-slide-to="{{i}}" class="active"></li>
        {%else%}
        <li data-target="#demo" data-slide-to="{{i}}" ></li>
        {% endif %}
        {% endfor %}

      </ul>

  <!-- The slideshow -->
          <div class="carousel-inner">
            {% for i in picnum %}
              {%if not i %}

                <div class="carousel-item active" >
                  <img src="{% static '' %}{{pictures.0}}"  alt='Los Angeles'  width="1100" height="500">


              {% else %}
                {%for picture in pictures %}
                    {%if picture != pictures.0 %}
                <div class="carousel-item " >
                  <img src="{% static '' %}{{picture}}"  alt='Los Angeles'  width="1100" height="500">
               {% endif %}
                </div>

                {% endfor %}
                {% endif %}
                {% endfor %}

          </div>

          <!-- Left and right controls -->
          <a class="carousel-control-prev" href="#demo" data-slide="prev">
            <span class="carousel-control-prev-icon"></span>
          </a>
          <a class="carousel-control-next" href="#demo" data-slide="next">
            <span class="carousel-control-next-icon"></span>
          </a>
        </div>
        <div >
          <div class="progress">
            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="{{donationbar}}"
              aria-valuemin="0" aria-valuemax="100" style="width:100%">
              {% widthratio donationbar 1 100 %}% Complete (success)
            </div>
          </div>
        </div>


        <hr>

        <!-- Post Content -->
        <p class="lead">{{project.details}}</p>


        <hr>

        <!-- Comments Form -->
        <div class="card my-4">
          <h5 class="card-header">Leave a Comment:</h5>
          <div class="card-body">
            <div>
              <div class="form-group">
                <textarea class="form-control" rows="3"></textarea>
              </div>
              <button  id="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>

        <!-- Single Comment -->
        <fragment id="comments">
        {% for comment in comments %}
        <div class="media mb-4">
          <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
          <div class="media-body">
            <h5 class="mt-0"> {{ comment.0 }}</h5>
            {{ comment.1 }}
          </div>
        </div>
        {% endfor %}
        </fragment>
        <!-- Comment with nested comments -->


      </fragment>

      <!-- Sidebar Widgets Column -->
      <div class="col-md-4">

        <!-- Search Widget -->
        <div class="card my-4">
          <h5 class="card-header">Rate</h5>
          <div class="card-body">
            <div id="rate">


            </div>
          </div>
        </div>

        <!-- Categories Widget -->
        <div class="card my-4">
          <h5 class="card-header">Tags</h5>
          <div class="card-body">
            <div class="row">
              {% for tag in tags %}
              <div class="col-lg-6">
                <ul class="list-unstyled mb-0">
                  <li>
                    <a href="#">{{tag}}</a>
                  </li>
                </ul>
              </div>
              {% endfor %}
        </div>
    </div>
     </div>   <!-- Side Widget -->
        <div class="card my-4">
          <h5 class="card-header">Category</h5>
          <div class="card-body">
            {{project.category}}
          </div>
        </div>


    <!-- /.row -->






<script>
  options = {
	emoji: 'U+2B50',
	count: 5,
	fontSize: 16,
	inputName: 'rating',
	onUpdate:function(rating) {
	console.log(rating);
	updateRate(rating);
  }
}
$('#rate').emojiRating(options);
document.querySelector("#submit").onclick=function(){
   comment=document.getElementsByTagName("textarea")[0].value
   console.log(comment)
   updateComment(comment)
}

</script>
</body>
</html>
